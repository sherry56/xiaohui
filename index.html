<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç°ç¼–ç¨‹ Â· ç²’å­äº¤äº’ç³»ç»Ÿ v3.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* ==================== 1. CSS æ ·å¼è¡¨ ==================== */
        :root {
            --bg-color: #05070a;
            --primary-color: #00f3ff; /* åŠ¨æ€å˜é‡ */
            --glass-bg: rgba(20, 30, 40, 0.7);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --success-color: #00ff9d;
            --font-family: 'Microsoft YaHei', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            overflow: hidden;
            width: 100vw; height: 100vh;
        }

        /* 3D å®¹å™¨ */
        #canvas-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background: radial-gradient(circle at center, #101520 0%, #000000 100%);
        }

        /* æš‚åœé®ç½©æ–‡å­— */
        #pause-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 4rem; color: rgba(255,255,255,0.1); font-weight: bold;
            pointer-events: none; z-index: 5; display: none;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
        }

        /* UI å±‚ */
        #ui-layer {
            position: relative; z-index: 10; width: 100%; height: 100%;
            display: flex; flex-direction: column; pointer-events: none;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        header {
            text-align: center; padding: 15px 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            pointer-events: auto;
        }
        h1 { font-size: 1.8rem; letter-spacing: 4px; color: var(--text-main); text-shadow: 0 0 10px var(--primary-color); }

        /* ä¸»å¸ƒå±€ */
        .main-content {
            flex: 1; display: grid; grid-template-columns: 320px 1fr 320px; gap: 20px; padding: 20px;
        }

        /* é€šç”¨é¢æ¿ */
        .panel {
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border); border-radius: 12px; padding: 20px;
            pointer-events: auto; display: flex; flex-direction: column;
            transition: border-color 0.3s;
        }
        .panel:hover { border-color: var(--primary-color); }
        .panel-title { color: var(--primary-color); font-weight: bold; margin-bottom: 12px; font-size: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;}

        /* å·¦ä¾§æ‘„åƒå¤´ */
        .camera-box {
            width: 100%; aspect-ratio: 4/3; background: #000; border-radius: 6px; overflow: hidden; margin-bottom: 10px; position: relative; border: 1px solid #333;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        #overlay-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: scaleX(-1); }
        
        .btn {
            padding: 10px; margin-bottom: 10px; width: 100%;
            background: rgba(0, 243, 255, 0.15); border: 1px solid var(--primary-color);
            color: white; border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .btn:hover { background: var(--primary-color); color: #000; }
        .btn.stop { border-color: #ff4757; background: rgba(255, 71, 87, 0.15); color: #ff4757; }
        .btn.stop:hover { background: #ff4757; color: white; }

        .status-text { font-size: 0.85rem; color: #aaa; line-height: 1.4; }

        /* å³ä¾§æ§åˆ¶ */
        .code-block {
            background: #0d1117; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 0.75rem; color: #8b949e;
            border: 1px solid #30363d; margin-bottom: 15px; height: 100px; overflow: hidden; transition: 0.3s;
        }
        .code-block.highlight {
            border-color: var(--primary-color); box-shadow: 0 0 20px rgba(0, 243, 255, 0.2); transform: scale(1.02); color: #fff;
        }

        .gesture-list { font-size: 0.8rem; color: #ccc; margin-bottom: 15px; }
        .g-item { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 2px;}

        .sim-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .sim-btn {
            padding: 6px; font-size: 0.75rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: #fff; border-radius: 4px; cursor: pointer;
        }
        .sim-btn:hover { border-color: var(--primary-color); background: rgba(255,255,255,0.2); }

        /* Toast æç¤º */
        #toast {
            position: fixed; top: 12%; right: 40px;
            background: rgba(0, 255, 157, 0.2); border: 1px solid var(--success-color); color: var(--success-color);
            padding: 15px 25px; border-radius: 8px; backdrop-filter: blur(10px);
            font-weight: bold; transform: translateX(150%); transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            display: flex; align-items: center; gap: 10px; z-index: 100; box-shadow: 0 0 30px rgba(0, 255, 157, 0.2);
        }
        #toast.show { transform: translateX(0); }

    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div id="pause-overlay">PAUSED</div>
    
    <div id="toast">
        <span style="font-size: 1.5rem">ğŸ‘</span>
        <div>
            <div>ç¼–è¯‘é€šè¿‡</div>
            <div style="font-size: 0.8rem; opacity: 0.8;">Build Success (12ms)</div>
        </div>
    </div>

    <div id="ui-layer">
        <header>
            <h1>å°ç°ç¼–ç¨‹</h1>
            <div style="font-size: 0.9rem; opacity: 0.8; color: var(--primary-color);">ç²’å­æ“ä½œç³»ç»Ÿ Â· è§†è§‰äº¤äº’æ¼”ç¤º</div>
        </header>

        <div class="main-content">
            <section class="panel">
                <div class="panel-title">è§†è§‰ä¼ æ„Ÿå™¨</div>
                <div class="camera-box">
                    <video id="webcam" autoplay playsinline muted></video>
                    <canvas id="overlay-canvas"></canvas>
                </div>
                <button class="btn" id="btn-start">å¯åŠ¨æ‘„åƒå¤´</button>
                <button class="btn stop" id="btn-stop">åœæ­¢</button>
                <div class="status-text" id="status-log">
                    [ç³»ç»Ÿå°±ç»ª] ç­‰å¾…å¯åŠ¨ã€‚<br>ç²’å­æ–‡å­—å·²åˆå§‹åŒ–ä¸º 50% å¤§å°ã€‚
                </div>
            </section>

            <section></section>

            <section class="panel">
                <div class="panel-title">æ ¸å¿ƒä»£ç åŒº (Core)</div>
                <div class="code-block" id="code-view">
                    <div style="color:#ff7b72">import</div> VisualOS <div style="color:#ff7b72">from</div> 'xiaohui-lib';
                    <br>
                    <span style="color:#79c0ff">const</span> app = <span style="color:#ff7b72">new</span> Application();
                    <br>
                    <span style="color:#8b949e">// ç­‰å¾…æ‰‹åŠ¿è¾“å…¥...</span>
                    <br>
                    app.<span style="color:#d2a8ff">run</span>();
                </div>

                <div class="panel-title">æ‰‹åŠ¿æŒ‡ä»¤è¡¨</div>
                <div class="gesture-list">
                    <div class="g-item"><span>âœ‹ å¼ å¼€æ‰‹æŒ</span> <span>æ–‡å­—æ”¾å¤§å‘å…‰</span></div>
                    <div class="g-item"><span>ğŸ‘‡ å‘ä¸‹æ»‘åŠ¨</span> <span>ç²’å­å‘ä¸‹æ•£è½</span></div>
                    <div class="g-item"><span>ğŸ‘† å‘ä¸Šæ»‘åŠ¨</span> <span>ç²’å­èšåˆé‡ç»„</span></div>
                    <div class="g-item"><span>â¬…ï¸ å‘å·¦æ»‘åŠ¨</span> <span>ä¸Šä¸€ä¸»é¢˜è‰²</span></div>
                    <div class="g-item"><span>â¡ï¸ å‘å³æ»‘åŠ¨</span> <span>ä¸‹ä¸€ä¸»é¢˜ + é«˜äº®</span></div>
                    <div class="g-item"><span>ğŸ‘ ç«–å¤§æ‹‡æŒ‡</span> <span>ç¼–è¯‘æˆåŠŸç‰¹æ•ˆ</span></div>
                    <div class="g-item"><span>âœŠ æ¡ç´§æ‹³å¤´</span> <span>æš‚åœ/æ¢å¤</span></div>
                </div>

                <div class="panel-title">æ‰‹åŠ¨æ¨¡æ‹Ÿæµ‹è¯•</div>
                <div class="sim-grid">
                    <button class="sim-btn" onclick="triggerGesture('palm')">âœ‹ æ”¾å¤§å‘å…‰</button>
                    <button class="sim-btn" onclick="triggerGesture('swipe_down')">ğŸ‘‡ å‘ä¸‹æ•£è½</button>
                    <button class="sim-btn" onclick="triggerGesture('swipe_up')">ğŸ‘† èšåˆé‡ç»„</button>
                    <button class="sim-btn" onclick="triggerGesture('swipe_left')">â¬…ï¸ ä¸Šä¸€è‰²</button>
                    <button class="sim-btn" onclick="triggerGesture('swipe_right')">â¡ï¸ ä¸‹ä¸€è‰²</button>
                    <button class="sim-btn" onclick="triggerGesture('thumb_up')" style="color:var(--success-color); border-color:var(--success-color)">ğŸ‘ ç¼–è¯‘æˆåŠŸ</button>
                    <button class="sim-btn" onclick="triggerGesture('fist')">âœŠ æš‚åœ/æ¢å¤</button>
                </div>
            </section>
        </div>
    </div>

    <script>
        /* ==================== 2. å…¨å±€é…ç½® ==================== */
        const config = {
            themes: [0x00f3ff, 0xbd00ff, 0x00ff9d, 0xffaa00],
            themeIndex: 0,
            text: "å°ç°ç¼–ç¨‹",
            isPaused: false,
            isCameraOn: false,
            baseScale: 0.5,    // æ ¸å¿ƒè¦æ±‚ï¼šé»˜è®¤ç¼©å°ä¸€åŠ
            targetScale: 0.5,  // åŠ¨æ€ç¼©æ”¾ç›®æ ‡
            particleState: 'normal', // normal, falling, pulsing
            cameraZ: 150
        };

        const dom = {
            video: document.getElementById('webcam'),
            canvas: document.getElementById('overlay-canvas'),
            ctx: document.getElementById('overlay-canvas').getContext('2d'),
            status: document.getElementById('status-log'),
            toast: document.getElementById('toast'),
            codeView: document.getElementById('code-view'),
            pauseOverlay: document.getElementById('pause-overlay')
        };

        /* ==================== 3. Three.js é€»è¾‘ ==================== */
        let scene, camera, renderer, particles;
        let originalPositions, velocities;
        // é¼ æ ‡/æ‰‹åŠ¿è·Ÿéšç›®æ ‡ç‚¹
        let targetPos = new THREE.Vector3(0, 0, 0);

        function initThree() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = config.cameraZ;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);

            createParticles();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            document.addEventListener('mousemove', onMouseMove);

            animate();
        }

        // åˆ›å»ºé«˜æ¸…æ–‡å­—ç²’å­
        function createParticles() {
            const w = 1024, h = 256;
            const cvs = document.createElement('canvas');
            cvs.width = w; cvs.height = h;
            const ctx = cvs.getContext('2d');
            
            ctx.fillStyle = '#000'; ctx.fillRect(0,0,w,h);
            ctx.fillStyle = '#fff'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.font = 'bold 160px "Microsoft YaHei", sans-serif';
            ctx.fillText(config.text, w/2, h/2);

            const data = ctx.getImageData(0,0,w,h).data;
            const points = [];
            const stride = 4; // é‡‡æ ·å¯†åº¦

            for(let y=0; y<h; y+=stride) {
                for(let x=0; x<w; x+=stride) {
                    if(data[(y*w+x)*4] > 128) {
                        // åæ ‡å±…ä¸­
                        const px = (x - w/2) * 0.35;
                        const py = -(y - h/2) * 0.35;
                        points.push(px, py, 0);
                    }
                }
            }

            const geo = new THREE.BufferGeometry();
            const posAttr = new THREE.Float32BufferAttribute(points, 3);
            geo.setAttribute('position', posAttr);
            
            originalPositions = posAttr.clone(); // å¤‡ä»½åˆå§‹ä½ç½®
            velocities = new Float32Array(points.length); // é€Ÿåº¦æ•°ç»„

            const mat = new THREE.PointsMaterial({
                color: config.themes[0],
                size: 1.2,
                transparent: true,
                opacity: 0.9,
                blending: THREE.AdditiveBlending
            });

            particles = new THREE.Points(geo, mat);
            
            // æ ¸å¿ƒè¦æ±‚ï¼šé»˜è®¤ç¼©å°ä¸€åŠ
            particles.scale.set(config.baseScale, config.baseScale, config.baseScale);
            
            scene.add(particles);
        }

        function animate() {
            requestAnimationFrame(animate);
            if(config.isPaused) return;

            if(!particles) return;

            // 1. å¤„ç†ç¼©æ”¾ (å¼ æ‰‹æ”¾å¤§é€»è¾‘)
            // å¹³æ»‘æ’å€¼åˆ° targetScale (0.5 æˆ– 1.0)
            const currentScale = particles.scale.x;
            if(Math.abs(currentScale - config.targetScale) > 0.001) {
                const newScale = currentScale + (config.targetScale - currentScale) * 0.1;
                particles.scale.set(newScale, newScale, newScale);
            }

            // 2. æ•´ä½“è·Ÿéšé¼ æ ‡/æ‰‹åŠ¿
            particles.position.x += (targetPos.x - particles.position.x) * 0.1;
            particles.position.y += (targetPos.y - particles.position.y) * 0.1;

            // 3. ç²’å­ç‰©ç†é€»è¾‘
            const pos = particles.geometry.attributes.position.array;
            const orig = originalPositions.array;

            if(config.particleState === 'falling') {
                // ä¸‹æ»‘ï¼šå‘ä¸‹æ•£è½é€»è¾‘
                for(let i=0; i<pos.length; i+=3) {
                    velocities[i+1] -= 0.05; // é‡åŠ›åŠ é€Ÿ
                    velocities[i]   += (Math.random()-0.5) * 0.1; // æ°´å¹³éšæœºæ¼‚ç§»
                    
                    pos[i]   += velocities[i];
                    pos[i+1] += velocities[i+1];
                    pos[i+2] += velocities[i+2];

                    // è¾¹ç•Œåå¼¹ï¼ˆæ¨¡æ‹Ÿåœ°é¢ï¼‰
                    if(pos[i+1] < -100) {
                        pos[i+1] = -100;
                        velocities[i+1] *= -0.5;
                    }
                }
            } else {
                // æ­£å¸¸/é‡ç»„ï¼šé£å›åŸä½
                // æ·»åŠ ä¸€ç‚¹æ‚¬æµ®åŠ¨ç”»
                const time = Date.now() * 0.002;
                
                for(let i=0; i<pos.length; i+=3) {
                    // å¼ºåŠ›å¸é™„
                    pos[i]   += (orig[i] - pos[i]) * 0.08;
                    pos[i+1] += (orig[i+1] - pos[i+1]) * 0.08;
                    pos[i+2] += (orig[i+2] - pos[i+2]) * 0.08;
                }
                
                // æ•´ä½“å¾®å¼±å‘¼å¸
                particles.rotation.y = Math.sin(time * 0.5) * 0.05;
            }

            particles.geometry.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }

        function onMouseMove(e) {
            if(config.isCameraOn || config.isPaused) return;
            updateTargetPos(e.clientX, e.clientY);
        }

        function updateTargetPos(x, y) {
            // å°†å±å¹•åæ ‡æ˜ å°„åˆ°å¤§è‡´çš„3Då¹³é¢èŒƒå›´
            const cx = (x / window.innerWidth) * 2 - 1;
            const cy = -(y / window.innerHeight) * 2 + 1;
            const range = 80; // ç§»åŠ¨èŒƒå›´
            targetPos.set(cx * range, cy * range * 0.6, 0);
        }

        /* ==================== 4. æ‰‹åŠ¿äº¤äº’é€»è¾‘ ==================== */
        
        window.triggerGesture = function(type) {
            if(config.isPaused && type !== 'fist') {
                logStatus("âš ï¸ ç³»ç»Ÿå·²æš‚åœï¼Œè¯·æ¡æ‹³æ¢å¤", true);
                return;
            }

            drawBox(type);

            switch(type) {
                case 'palm': // âœ‹ å¼ æ‰‹ï¼šæ”¾å¤§å‘å…‰
                    config.targetScale = 1.0; // æ”¾å¤§åˆ°åŸå°ºå¯¸
                    particles.material.color.setHex(0xffffff); // å˜ç™½é«˜äº®
                    particles.material.opacity = 1.0;
                    logStatus("âœ‹ æ£€æµ‹åˆ°å¼ æ‰‹ï¼šæ–‡å­—æ”¾å¤§æ¿€æ´»");
                    
                    // 1.5ç§’åè‡ªåŠ¨æ¢å¤
                    setTimeout(() => {
                        config.targetScale = config.baseScale;
                        particles.material.color.setHex(config.themes[config.themeIndex]);
                        particles.material.opacity = 0.9;
                    }, 1500);
                    break;

                case 'swipe_down': // ğŸ‘‡ ä¸‹æ»‘ï¼šå‘ä¸‹æ•£è½
                    config.particleState = 'falling';
                    // èµ‹äºˆéšæœºåˆé€Ÿåº¦
                    for(let i=0; i<velocities.length; i++) velocities[i] = (Math.random()-0.5);
                    logStatus("ğŸ‘‡ æ£€æµ‹åˆ°ä¸‹æ»‘ï¼šç²’å­å—é‡åŠ›æ•£è½");
                    break;

                case 'swipe_up': // ğŸ‘† ä¸Šæ»‘ï¼šèšåˆ
                    config.particleState = 'normal';
                    logStatus("ğŸ‘† æ£€æµ‹åˆ°ä¸Šæ»‘ï¼šç²’å­é€†é‡åŠ›èšåˆ");
                    break;

                case 'swipe_left': // â¬…ï¸ å·¦æ»‘ï¼šä¸Šä¸€è‰²
                    switchTheme(-1);
                    logStatus("â¬…ï¸ åˆ‡æ¢ä¸Šä¸€ä¸»é¢˜è‰²");
                    break;

                case 'swipe_right': // â¡ï¸ å³æ»‘ï¼šä¸‹ä¸€è‰² + ä»£ç é«˜äº®
                    switchTheme(1);
                    dom.codeView.classList.add('highlight');
                    setTimeout(()=>dom.codeView.classList.remove('highlight'), 800);
                    logStatus("â¡ï¸ åˆ‡æ¢ä¸‹ä¸€ä¸»é¢˜ & è¿è¡Œä»£ç ");
                    break;

                case 'thumb_up': // ğŸ‘ ç‚¹èµï¼šç¼–è¯‘é€šè¿‡
                    dom.toast.classList.add('show');
                    setTimeout(()=>dom.toast.classList.remove('show'), 3000);
                    // ç²’å­å˜ç»¿ç‰¹æ•ˆ
                    const oldColor = particles.material.color.getHex();
                    particles.material.color.setHex(0x00ff9d);
                    setTimeout(()=> {
                        particles.material.color.setHex(oldColor);
                    }, 1000);
                    logStatus("ğŸ‘ è¯†åˆ«æˆåŠŸï¼šç¼–è¯‘é€šè¿‡");
                    break;

                case 'fist': // âœŠ æ¡æ‹³ï¼šæš‚åœ/æ¢å¤
                    config.isPaused = !config.isPaused;
                    dom.pauseOverlay.style.display = config.isPaused ? 'block' : 'none';
                    logStatus(config.isPaused ? "âœŠ ç³»ç»Ÿæš‚åœ (æ—¶é—´é™æ­¢)" : "âœŠ ç³»ç»Ÿæ¢å¤è¿è¡Œ");
                    break;
            }
        };

        function switchTheme(dir) {
            config.themeIndex = (config.themeIndex + dir + config.themes.length) % config.themes.length;
            const color = config.themes[config.themeIndex];
            particles.material.color.setHex(color);
            document.documentElement.style.setProperty('--primary-color', '#' + new THREE.Color(color).getHexString());
        }

        function logStatus(msg, isWarn=false) {
            dom.status.innerHTML = msg;
            dom.status.style.color = isWarn ? '#ff4757' : '#aaa';
            dom.status.style.borderLeftColor = isWarn ? '#ff4757' : 'var(--primary-color)';
        }

        /* ==================== 5. æ‘„åƒå¤´ä¸æ¨¡æ‹Ÿè¯†åˆ« ==================== */
        let streamInterval = null;

        document.getElementById('btn-start').addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                dom.video.srcObject = stream;
                config.isCameraOn = true;
                logStatus("è§†è§‰è¯†åˆ«å·²å¯åŠ¨ï¼Œæ­£åœ¨æ‰«ææ‰‹åŠ¿...");
                startDetectionLoop();
            } catch(e) {
                alert("æ‘„åƒå¤´å¼€å¯å¤±è´¥: " + e.message);
            }
        });

        document.getElementById('btn-stop').addEventListener('click', () => {
            const stream = dom.video.srcObject;
            if(stream) stream.getTracks().forEach(t=>t.stop());
            dom.video.srcObject = null;
            config.isCameraOn = false;
            clearInterval(streamInterval);
            dom.ctx.clearRect(0,0,300,300);
            logStatus("æ‘„åƒå¤´å·²å…³é—­ã€‚");
        });

        function startDetectionLoop() {
            dom.canvas.width = dom.video.clientWidth;
            dom.canvas.height = dom.video.clientHeight;

            streamInterval = setInterval(() => {
                if(config.isPaused || !config.isCameraOn) return;

                // 1. æ¨¡æ‹Ÿæ‰‹åŠ¿éšæœºè§¦å‘ (20% æ¦‚ç‡)
                if(Math.random() < 0.2) {
                    const gestures = ['palm', 'swipe_down', 'swipe_up', 'swipe_left', 'swipe_right', 'thumb_up', 'fist'];
                    const g = gestures[Math.floor(Math.random() * gestures.length)];
                    triggerGesture(g);
                } else {
                    // ä»…ç»˜åˆ¶æ‰«ææ•ˆæœ
                    drawScanEffect();
                    // æ¨¡æ‹Ÿæ‘„åƒå¤´ä¸‹çš„æ‰‹éƒ¨ç§»åŠ¨
                    const time = Date.now() * 0.001;
                    const x = Math.sin(time)*400 + window.innerWidth/2;
                    const y = Math.cos(time*0.8)*200 + window.innerHeight/2;
                    updateTargetPos(x, y);
                }
            }, 2500); // æ¯ 2.5 ç§’å°è¯•ä¸€æ¬¡è¯†åˆ«
        }

        function drawBox(type) {
            const ctx = dom.ctx;
            const w = dom.canvas.width, h = dom.canvas.height;
            ctx.clearRect(0,0,w,h);
            
            // éšæœºæ¡†
            const rx = Math.random()*(w-100), ry = Math.random()*(h-100);
            const color = '#' + new THREE.Color(config.themes[config.themeIndex]).getHexString();
            
            ctx.strokeStyle = color; ctx.lineWidth = 3;
            ctx.strokeRect(rx, ry, 120, 120);
            ctx.fillStyle = color; ctx.fillRect(rx, ry-25, 120, 25);
            ctx.fillStyle = '#000'; ctx.font = 'bold 14px sans-serif';
            ctx.fillText(type.toUpperCase(), rx+5, ry-7);
        }

        function drawScanEffect() {
            const ctx = dom.ctx;
            const w = dom.canvas.width, h = dom.canvas.height;
            ctx.clearRect(0,0,w,h);
            const y = (Date.now() / 5) % h;
            ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y);
            ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.stroke();
        }

        window.onload = initThree;
    </script>
</body>
</html>
